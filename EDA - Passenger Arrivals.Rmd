---
title: "EDA of Passengers Arrivals Dataset"
output:
  html_document:
    df_print: paged
---

```{r Import Libraries, warning=FALSE}
# import libraries

library(tsdl)
library(forecast)
library(dygraphs)
library(lubridate)
library(xts)
```

 The dataset is present in the tsdl library of R.
 
```{r Call Dataset}
d = subset(tsdl, description="Passenger arrivals")

# Details of the dataset
print(attributes(d[[1]])$description)
```

A basic plot is first drawn to have an idea of the structure of the time series.
```{r Plot 1}
autoplot(d[[1]])
```
The plot displays seasonality of a very specific period, and there does not seem to be any trend.

Also the date time values are not given, and hence need to be added.

```{r Function }
# Function to create a sequence of time values for a given day

timeperiodperday <- function(i){
  startdt = paste0("2005-3-", i, " 6:30")
  enddt = paste0("2005-3-", i, " 22:00")
  dt = seq(ymd_hm(startdt), ymd_hm(enddt), by=900)
  return(dt)
}
```

```{r}

# adding the date time values and storing it as a xts object for better handling.

i = 1
llim = 0
ulim = 63
dt = timeperiodperday(i)
tsdata = xts(d[[1]][llim:ulim], order.by = dt, tzone = "UTC")

for (i in 2:21){
  dt = timeperiodperday(i)
  llim = ulim + 1
  ulim = i+(i*62)
  ts = xts(d[[1]][llim:ulim], order.by = dt, tzone = "UTC")
  tsdata = rbind(tsdata, ts)
}

print(length(tsdata))
```

```{r}
head(tsdata)
```
```{r}
tail(tsdata)
```

```{r Dygraph}
# Dygraph showing the cleaned data

dygraph(tsdata, main = "Passenger Arrivals for each 15 minute interval") %>% dyOptions(useDataTimezone = TRUE, drawPoints = TRUE, pointSize = 1.5) %>% dyRangeSelector(height = 20)
```

Starting from the left, there are 4 similar patterns with decreasing height. The 5th and 6th pattern are considerably low in height, compared to the former 4. Each such pattern corresponds to a single day in the time period of 1st March, 2005 to 21st March 2005.

This sequence repeats itself, with 5 peaks and 2 low lying patterns. This corresponds to the 5 weekdays, when the traffic is quite large, and the 2 weekend days, which are holidays and hence, the usual no. of passengers remains low.

Consider a single weekday, say 1st March, 2005. The no. of passengers keeps growing till about 13:00 hrs, then there's a small drop till 17:00 hrs and the graph reaches its peak at around 19:00 hrs and then drops down. This makes perfect sense as the no. of people commuting to their workplace is high in the morning, during the day, when the sun is high up, not many people prefer going out, and again as the people return to their homes in the evening, the graph rises. 

This pattern is quite different on weekends, when the no. of paasengers is considerably low throughout the day, specially on Sundays.

```{r}
# decompose the time series into an additive model wrt trend, seasonality and irregularity

x = ts(d[[1]], frequency = 63)
ts_decom = decompose(x)

attributes(ts_decom)
```
```{r}
plot(ts_decom)
```

There is no overall trend in the data, though there is the same weekly trend throughout the time period. 

As concluded from the 1st plot itself, the data is seasonal and this seasonality plays a major role in the time series.

The random component of the time series is more or less stationary.

